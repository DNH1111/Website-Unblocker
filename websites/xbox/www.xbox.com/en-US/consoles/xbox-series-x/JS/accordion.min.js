$(document).ready(function () {
    //$(".accordion ul").attr("role", "tablist");
    //$(".accordion ul li").attr("aria-expanded", "false").attr("role", "tab");
    $(".accordion ul li").attr("aria-expanded", "false");
    var e = $(".accordion ul li"),
        o = $(".accordion ul"),
        n = $(".btnClose");
        /*
    $(e).each(function (){
      $(this).find(".btnClose")[0].attr("tabindex", "-1");
  });*/
    if ($(window).outerWidth(true) < 1084) var i = "mobiBG";
    else var i = "dsktopBG";
    $(o).css("background-image", "url(" + $(e).attr(i) + ")");
    var a = (function () {
        var e = {};
        return function (o, n, i) {
            i || (i = "Fires only once."), e[i] && clearTimeout(e[i]), (e[i] = setTimeout(o, n));
        };
    })();
    $(window).resize(function () {
        console.log("$(window).outerWidth(true) " + $(window).outerWidth(true));
        console.log("prop scrollwidth " + $("body").prop("scrollWidth"));
        a(
            function () {
                (i = $(window).outerWidth(true) < 1084 ? "mobiBG" : "dsktopBG"), $(o).css("background-image", "url(" + $(".expanded").attr(i) + ")");
            },
            200,
            "pageresize"
        );
    }),
        $(e).on("keydown", function (e) {
            if (13 == e.keyCode || 32 == e.keyCode) {
              e.preventDefault();
              $(this).click();
            } 
        }),
        $(document).on("keydown", ".btnClose" , function (e) {
            if (13 == e.keyCode || 32 == e.keyCode) {
              e.preventDefault();
              $(this).click();
            } 
        }),
        $(e).on("click", function () {
            $(e).attr("tabindex", "0");
            $(this).attr("tabindex", "-1");
            if ($(this).hasClass("initial") || $(this).hasClass("contracted")) {
                console.log("not");
                $(this).find(".btnClose").show();
                $(this).find(".btnClose")[0].focus();
                var panText = $(this).find(".mainCont").attr("aria-label") + $(this).find(".btnClose").attr("aria-label");
                if ($(".carouselAnnounce").text().toLowerCase().indexOf("...") === -1) {
                  panText = $(this).find(".mainCont").attr("aria-label") + $(this).find(".btnClose").attr("aria-label") + "...";
                }
                $(".carouselAnnounce").text(panText);
            }
            $(".accordion ul li").attr("aria-expanded", "false");
  
            $(this).addClass("expanded").removeClass("initial").removeClass("contracted");
  
            $(e).not(this).addClass("contracted").removeClass("expanded").removeClass("initial");
            $(e).not(this).each(function (){
              $(this).find(".btnClose").hide();
            })
  
            $(o).css("background-image", "url(" + $(this).attr(i) + ")");
  
            if ($(this).hasClass("expanded")) {
                //$(this).find(".btnClose")[0].focus();
                $(this).attr("tabindex", "-1");
                $(this).attr("aria-expanded", "true");
            }
  
        }),
        $(n).on("click", function (o) {
            $(e).addClass("initial"), $(e).removeClass("expanded").removeClass("contracted"), o.stopPropagation();
            $(this).closest("li").focus();
            $(this).hide();
            $(e).attr("tabindex", "0");
            $(".accordion ul li").attr("aria-expanded", "false");
        });
  });
  